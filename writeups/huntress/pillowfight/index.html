<!doctype html><html lang=en><head><meta charset=utf-8><title> PillowFight</title><meta content="width=device-width,initial-scale=1.0" name=viewport><link href=https://yctf.ch/css/main.css rel=stylesheet><link as=font crossorigin href=https://yctf.ch/fonts/JetBrainsMono-VariableFont_wght.ttf rel=preload type=font/ttf><link href=https://yctf.ch/rss.xml rel=alternate title=RSS type=application/rss+xml><link href=https://yctf.ch/atom.xml rel=alternate title=RSS type=application/atom+xml><script crossorigin src=https://cdn.jsdelivr.net/npm/@twemoji/api@latest/dist/twemoji.min.js></script><script crossorigin src=https://cdn.jsdelivr.net/npm/fuse.js@7.1.0/dist/fuse.basic.min.js></script><script defer src=https://yctf.ch/js/main.js></script><script defer src=https://yctf.ch/search_index.en.js></script><body class=min-h-[100svh]><div class="w-[50svw] md:w-96 bg-popover absolute left-1/2 top-1/3 transform -translate-x-1/2 -translate-y-1/2 hidden shadow-lg" id=goto-popup><input class="w-full h-8 lg:h-12 px-2 py-1 lg:px-4 lg:py-2" id=goto-input placeholder=Search><div class="w-full h-0.5 bg-muted"></div><div class="w-full max-h-96 overflow-y-auto flex flex-col" id=goto-results></div></div><a class="top-0 left-0 fixed" href=https://yctf.ch> <div class="h-18 md:h-26 lg:h-32 p-2 md:p-4"><div class="w-full h-full flex items-center justify-center"><div class="w-full h-full [&>svg]:w-full [&>svg]:h-full [&>svg]:object-contain invert-colors select-none"><svg viewbox="0 0 300 300" fill=none xmlns=http://www.w3.org/2000/svg><g class=text-container><text style="text-transform:none;letter-spacing:normal;white-space:pre;fill:#e63e3d;fill-opacity:1;direction:ltr;font-family:JetBrains Mono;font-size:129px;font-style:normal;font-weight:800;text-decoration:none" class=fills dominant-baseline=ideographic lengthadjust=spacingAndGlyphs textlength=77.406 x=49.297 y=171.602>Y</text></g><g class=text-container><text style="text-transform:none;letter-spacing:normal;white-space:pre;fill:#e63e3d;fill-opacity:1;direction:ltr;font-family:JetBrains Mono;font-size:129px;font-style:normal;font-weight:800;text-decoration:none" class=fills dominant-baseline=ideographic lengthadjust=spacingAndGlyphs textlength=77.406 x=173.297 y=171.602>C</text></g><g class=text-container><text style="text-transform:none;letter-spacing:normal;white-space:pre;fill:#e63e3d;fill-opacity:1;direction:ltr;font-family:JetBrains Mono;font-size:129px;font-style:normal;font-weight:800;text-decoration:none" class=fills dominant-baseline=ideographic lengthadjust=spacingAndGlyphs textlength=77.406 x=49.297 y=297.602>T</text></g><g class=text-container><text style="text-transform:none;letter-spacing:normal;white-space:pre;fill:#e63e3d;fill-opacity:1;direction:ltr;font-family:JetBrains Mono;font-size:129px;font-style:normal;font-weight:800;text-decoration:none" class=fills dominant-baseline=ideographic lengthadjust=spacingAndGlyphs textlength=77.406 x=173.297 y=297.602>F</text></g></svg></div></div></div> </a><div class="text-secondary-foreground mx-6 md:py-2 py-1 font-black text-lg lg:text-xl top-0 right-0 fixed w-18 md:w-26 h-18 md:h-26 lg:h-32 p-2 md:p-4 text-center flex items-center justify-center"></div><main id=scroll-element><div class="mt-24 mx-4 mb-24 sm:mx-0"><article class="prose dark:prose-invert mx-auto lg:prose-lg"><h1>PillowFight <span class="text-muted-foreground text-xl">by Tyr</span></h1><div class="flex flex-row gap-4 items-center"><span><strong>2024-09-30</strong></span><span class=text-muted-foreground>(1 min. read)</span> - <span class="flex flex-row gap-2"> </span><div class=flex-grow></div><button class=cursor-pointer onclick=toggleAssets()><svg class="h-6 w-6 fill-none stroke-accent" viewbox="0 0 24 24" stroke-linecap=round stroke-linejoin=round stroke-width=2 xmlns=http://www.w3.org/2000/svg><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"></path></svg></button></div><div class="hidden px-2 py-1 md:px-4 md:py-2 border border-muted my-4" id=assets-container><div class="flex flex-wrap gap-3"><a class="inline-flex items-center gap-1 text-sm hover:text-primary transition-colors" href=/writeups/huntress/pillowfight/files/5PwNDCv.png> <svg class="w-4 h-4" viewbox="0 0 24 24" fill=currentColor><path d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/></svg> 5PwNDCv.png </a><a class="inline-flex items-center gap-1 text-sm hover:text-primary transition-colors" href=/writeups/huntress/pillowfight/files/ap64jNt.png> <svg class="w-4 h-4" viewbox="0 0 24 24" fill=currentColor><path d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/></svg> ap64jNt.png </a><a class="inline-flex items-center gap-1 text-sm hover:text-primary transition-colors" href=/writeups/huntress/pillowfight/files/DhWShYz.png> <svg class="w-4 h-4" viewbox="0 0 24 24" fill=currentColor><path d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/></svg> DhWShYz.png </a><a class="inline-flex items-center gap-1 text-sm hover:text-primary transition-colors" href=/writeups/huntress/pillowfight/files/ZgrT7eX.png> <svg class="w-4 h-4" viewbox="0 0 24 24" fill=currentColor><path d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/></svg> ZgrT7eX.png </a></div></div><h2 id=description>Description</h2><p>PillowFight uses <em><strong>advanced AI/MLRegressionLearning</strong></em> to combine two images of your choosing<p>*note to investors this is not techically true at the moment we're using a python library but please give us money and we'll deliver it we promise.<p><strong>Press the <code>Start</code> button on the top-right to begin this challenge.</strong><hr><p>Upon accessing the website, we find a form that allows uploading two images and combining them. There’s also a hint about API documentation available at <code>/swagger</code>. Exploring this documentation reveals an endpoint, <code>/combine</code>, where we can specify images along with an <code>eval_command</code> parameter for custom operations. Let’s test it by attempting to combine two images: <img alt src=https://yctf.ch/writeups/huntress/pillowfight/files/DhWShYz.png><p>Here's what we've got: <img alt src=https://yctf.ch/writeups/huntress/pillowfight/files/5PwNDCv.png><p>Let’s try using a different custom <code>eval_command</code> instead of <code>convert()</code> in the previous formData, maybe can we do some command injection. <img alt src=https://yctf.ch/writeups/huntress/pillowfight/files/ZgrT7eX.png><p>This attempt results in a "Bad Request", with the following response:<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json"><span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-json">  </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>error<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>'str' object has no attribute 'save'<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
</span></span><span class="z-source z-json"><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
</span></code></pre><p>It appears that the server expects an image output with a <code>.save()</code> attribute. So, what if we raise an exception instead to see the error response? Let's try this:<pre class="language-Python z-code" data-lang=Python><code class=language-Python data-lang=Python><span class="z-source z-python"><span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">exec</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">raise Exception(open("flag.txt").read())<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span></code></pre><p>Bingo! The flag appears in the response body as part of the error message. <img alt src=https://yctf.ch/writeups/huntress/pillowfight/files/ap64jNt.png><p>The flag is: <code>flag{b6b62e6c5cdfda3b3a8b87d90fd48d01}</code></article></div></main><div class="bg-secondary text-primary-foreground w-fit fixed bottom-4 float-right right-8 transition-all duration-200 opacity-0" title="Scroll to top" id=scroll-to-top><div class="bg-primary h-full absolute -z-10" id=scroll-fill></div><svg class="h-6 w-6 mx-4 md:my-2 my-1 fill-primary-foreground" viewbox="0 0 16 16" xmlns=http://www.w3.org/2000/svg><path d="M3.47 7.78a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0l4.25 4.25a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018L9 4.81v7.44a.75.75 0 0 1-1.5 0V4.81L4.53 7.78a.75.75 0 0 1-1.06 0Z"></path></svg></div>